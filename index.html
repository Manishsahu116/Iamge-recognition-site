<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AskAI</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="Images/fabicon.png" />
</head>

<body background="Images/background.jpg">
  <div>
    <div class="main">
      <div class="navbar">
        <div class="icon">
          <h2 class="logo">AskAI</h2>
        </div>

        <div class="menu">
          <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="about.html">ABOUT</a></li>
            <li><a href="object.html">OBJECTIVES</a></li>
            <li><a href="learn more.html">LEARN MORE</a></li>
            <li><a href="how we build.html">HOW WE BUILD</a></li>
            <li><a href="contact.html">CONTACT</a></li>
          </ul>
        </div>
      </div>
      <div class="content">
        <h1>
          <span>Image recognition<br />Chatbot</span>
        </h1>
        <p class="par">
          Get instant answers, find creative inspiration, learn something new.
        </p>

        <div class="container">
          <div class="h"></div>
          <div class="main">
            <div class="image-upload">
              <input type="file" id="file-input" accept="image/*" />
              <label for="file-input">Choose Image</label>
            </div>
            <div class="image-display">
              <div class="uploaded-image-container">
                <img id="uploaded-image" src="#" alt="Uploaded Image" />
              </div>
              <div id="loading-spinner" class="loading-spinner"></div>
              <!-- Loading spinner -->
            </div>
            <div class="result" id="result">
              <p>Recognition Result: <span id="recognition-result"></span></p>
              <p>
                Classification Result:
                <span id="classification-result"></span>
              </p>
              <p>
                Text Extraction Result: <br />
                <span id="text-extraction-result"></span>
              </p>
            </div>
            <div class="text-extraction">
              <button onclick="extractTextFromImage()">Extract Text</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <p>
        &copy; Copyright 2024 - All Rights Reserved <br />
        Developed by Manish
      </p>
    </div>
  </div>

  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/deeplab"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <script>
    let cocoSsdModelPromise = cocoSsd.load();
    let mobilenetModelPromise = mobilenet.load();

    async function runObjectDetection(imageElement) {
      const model = await cocoSsdModelPromise;
      const predictions = await model.detect(imageElement);
      const resultElement = document.getElementById("recognition-result");
      resultElement.textContent = predictions
        .map((prediction) => prediction.class)
        .join(", ");
    }

    async function runImageClassification(imageElement) {
      const model = await mobilenetModelPromise;
      const predictions = await model.classify(imageElement);
      const resultElement = document.getElementById("classification-result");
      resultElement.textContent = predictions[0].className;
    }

    async function extractTextFromImage() {
      const imageElement = document.getElementById("uploaded-image");
      const resultElement = document.getElementById("text-extraction-result");
      resultElement.innerHTML = ""; // Clear previous results

      // Show loading spinner
      const loadingSpinner = document.getElementById("loading-spinner");
      loadingSpinner.classList.add("show"); // Add 'show' class to display loading spinner

      Tesseract.recognize(imageElement, "eng", {
        logger: (m) => console.log(m),
      })
        .then(({ data: { text } }) => {
          // Hide loading spinner
          hideLoadingSpinner(); // Hide loading spinner

          if (text.trim() === "") {
            resultElement.textContent = "No text found";
          } else {
            const formattedText = text.split("\n").join("<br>"); // Insert <br> for line breaks
            resultElement.innerHTML = formattedText; // Use innerHTML to render HTML content
          }
        })
        .catch((error) => {
          console.error("Error extracting text:", error);
          hideLoadingSpinner(); // Hide loading spinner
          resultElement.textContent = "Error extracting text";
        });
    }

    function hideLoadingSpinner() {
      const loadingSpinner = document.getElementById("loading-spinner");
      loadingSpinner.classList.remove("show"); // Remove 'show' class to hide loading spinner
    }
    document
      .getElementById("file-input")
      .addEventListener("change", function (event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = async function (event) {
          const img = new Image();
          img.onload = async function () {
            document.getElementById("uploaded-image").src = img.src;
            await runObjectDetection(img);
            await runImageClassification(img);
          };
          img.src = event.target.result;
        };
        reader.readAsDataURL(file);
      });
  </script>
</body>

</html>